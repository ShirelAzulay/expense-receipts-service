# Receipts Validation API

A backend service for managing employee receipts.  
Employees can upload receipts (PDF or image) along with metadata (amount, date, event).  
The system validates that the metadata matches the actual content of the receipt and applies business plausibility checks.

---

## ğŸ¯ Project Purpose

The service provides:
1. **File Upload** â€“ Employees upload receipts (PDF or image).
2. **Metadata Storage** â€“ Amount, date, event type provided by the user.
3. **Validation** â€“ Compare provided metadata with extracted data from the receipt.
4. **Business Rules** â€“ Reject suspicious cases (e.g., â€œrefreshmentsâ€ but receipt contains â€œiPhoneâ€).
5. **API Responses** â€“ Return clear validation results.

---

## ğŸ›  Project Structure

```
expense-receipts-service/
 â”œâ”€â”€ src/                   # NestJS source code
 â”‚    â”œâ”€â”€ receipts/         # Receipts module (controller, service, DTOs)
 â”‚    â”œâ”€â”€ app.module.ts     # Root module
 â”‚    â””â”€â”€ main.ts           # Application entry point
 â”œâ”€â”€ swagger/               # Legacy OpenAPI + HTML docs
 â”‚    â”œâ”€â”€ receipts-api.yaml
 â”‚    â””â”€â”€ receipts-api.html
 â”œâ”€â”€ package.json           # Dependencies and scripts
 â”œâ”€â”€ tsconfig.json          # TypeScript config
 â””â”€â”€ README.md              # This file
```

---

## âš™ï¸ Setup and Run

### Install dependencies
```bash
npm install
```

### Run the server
```bash
# Development
npm run start:dev

# Production
npm run start:prod
```

The server will be available at:  
ğŸ‘‰ http://localhost:3000

---

## ğŸ“„ API Documentation

### Swagger (recommended)
After starting the server, open:

http://localhost:3000/api

### Legacy Redoc (optional)
```bash
npm install -g redoc-cli
redoc-cli bundle swagger/receipts-api.yaml -o swagger/receipts-api.html
```

---

## ğŸš Main Endpoints

- `POST /receipts` â€“ Upload a receipt with metadata.
- `POST /receipts/{id}/validate` â€“ Validate consistency between metadata and extracted data.
- `GET /receipts/{id}` â€“ Retrieve a specific receipt.
- `GET /receipts` â€“ List all receipts.

---

## ğŸ§¾ Example Metadata

```json
{
  "amount": 100,
  "date": "2025-09-25",
  "event": "Team lunch"
}
```

---

## ğŸ“Œ Usage Examples

### Upload a receipt (curl)
```bash
curl -X POST http://localhost:3000/receipts   -F "file=@/path/to/receipt.pdf"   -F 'metadata={"amount":100,"date":"2025-09-25","event":"Team lunch"}'
```

### Validate a receipt
```bash
curl -X POST http://localhost:3000/receipts/1/validate   -H "Content-Type: application/json"   -d '{"amount":100,"date":"2025-09-25","event":"Team lunch"}'
```

### Get all receipts
```bash
curl http://localhost:3000/receipts
```

---

## ğŸ§ª Testing

```bash
# Unit tests
npm run test

# End-to-end tests
npm run test:e2e

# Coverage
npm run test:cov
```

---

## ğŸš€ Deployment

For production it is recommended to use **pm2**:

```bash
npm install -g pm2
pm2 start dist/main.js --name receipts-api
pm2 save
pm2 startup
```

To check logs:
```bash
pm2 logs receipts-api
```

---

## ğŸ‘©â€ğŸ’» Development Workflow

### Generate a new module
```bash
nest generate module <name>
nest generate controller <name>
nest generate service <name>
```

### Update code after pulling from GitHub
```bash
git pull origin main
npm install
npm run build
pm2 restart receipts-api
```

---

## ğŸ“œ License

This project is MIT licensed.
